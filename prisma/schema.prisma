// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User Models
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id                    String    @id @default(cuid())
  name                  String?
  email                 String?   @unique
  emailVerified         DateTime?
  image                 String?
  role                  String    @default("student") // student, teacher, admin, parent, ep
  accounts              Account[]
  sessions              Session[]
  profile               Profile?
  studentProfile        StudentProfile?
  teacherProfile        TeacherProfile?
  parentProfile         ParentProfile?
  epProfile             EPProfile?
  accessibilitySettings AccessibilitySettings?
  accessibilityLogs     AccessibilityLog[]
  learningStyles        LearningStyle[]
  progressReports       ProgressReport[]
  assessmentResponses   AssessmentResponse[]
  enrollments           Enrollment[]
  createdCourses        Course[]
  createdLessons        Lesson[]
  createdAssessments    Assessment[]
  notifications         Notification[]
  messages              Message[]
  sentMessages          Message[]           @relation("SentMessages")
  pupilVoiceResponses   PupilVoiceResponse[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

// Profile Models
model Profile {
  id             String   @id @default(cuid())
  userId         String   @unique
  bio            String?  @db.Text
  dateOfBirth    DateTime?
  phoneNumber    String?
  address        String?  @db.Text
  city           String?
  country        String?
  postalCode     String?
  preferences    Json?    // User preferences
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model StudentProfile {
  id                String   @id @default(cuid())
  userId            String   @unique
  schoolId          String?
  gradeLevel        String?
  guardianEmail     String?
  guardianPhone     String?
  specialNeeds      String?  @db.Text
  accommodations    String?  @db.Text
  interests         String[] // Array of interests
  strengths         String[] // Array of strengths
  challenges        String[] // Array of challenges
  learningGoals     String[] // Array of learning goals
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  school            School?  @relation(fields: [schoolId], references: [id])
}

model TeacherProfile {
  id                String   @id @default(cuid())
  userId            String   @unique
  schoolId          String?
  subjects          String[] // Subjects taught
  gradeLevel        String?
  certifications    String[] // Certifications
  educationHistory  String?  @db.Text
  teachingPhilosophy String? @db.Text
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  school            School?  @relation(fields: [schoolId], references: [id])
}

model ParentProfile {
  id                String   @id @default(cuid())
  userId            String   @unique
  childrenIds       String[] // Array of student user IDs
  relationship      String?  // e.g., "Mother", "Father", "Guardian"
  preferredContactMethod String? // e.g., "Email", "Phone", "Text"
  availabilityTimes String?  // e.g., "Evenings", "Weekends"
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model School {
  id              String   @id @default(cuid())
  name            String
  address         String?  @db.Text
  city            String?
  country         String?
  postalCode      String?
  phoneNumber     String?
  email           String?
  website         String?
  type            String?  // e.g., "Public", "Private", "Charter"
  gradeRange      String?  // e.g., "K-5", "6-8", "9-12"
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  students        StudentProfile[]
  teachers        TeacherProfile[]
}

// Learning Models
model LearningStyle {
  id                String   @id @default(cuid())
  userId            String
  visual            Int      @default(0) // 0-100 scale
  auditory          Int      @default(0) // 0-100 scale
  readWrite         Int      @default(0) // 0-100 scale
  kinesthetic       Int      @default(0) // 0-100 scale
  sequential        Int      @default(0) // 0-100 scale
  global            Int      @default(0) // 0-100 scale
  active            Int      @default(0) // 0-100 scale
  reflective        Int      @default(0) // 0-100 scale
  verbal            Int      @default(0) // 0-100 scale
  intuitive         Int      @default(0) // 0-100 scale
  sensing           Int      @default(0) // 0-100 scale
  additionalStyles  Json?    // For other learning style models
  assessmentResults Json?    // Raw assessment data
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ProgressReport {
  id                String   @id @default(cuid())
  userId            String
  courseId          String?
  lessonId          String?
  title             String
  content           String   @db.Text
  strengths         String[] // Areas of strength
  areasForImprovement String[] // Areas needing improvement
  recommendations   String   @db.Text
  nextSteps         String   @db.Text
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  course            Course?  @relation(fields: [courseId], references: [id])
  lesson            Lesson?  @relation(fields: [lessonId], references: [id])
}

// Curriculum Models
model Course {
  id                String   @id @default(cuid())
  creatorId         String
  title             String
  description       String   @db.Text
  subject           String
  gradeLevel        String
  difficulty        String   @default("intermediate") // beginner, intermediate, advanced
  learningObjectives String[] // Array of learning objectives
  prerequisites     String[] // Array of prerequisites
  duration          Int?     // Estimated duration in minutes
  imageUrl          String?
  isPublished       Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  creator           User     @relation(fields: [creatorId], references: [id])
  lessons           Lesson[]
  enrollments       Enrollment[]
  progressReports   ProgressReport[]
  assessments       Assessment[]
}

model Lesson {
  id                String   @id @default(cuid())
  courseId          String
  creatorId         String
  title             String
  description       String   @db.Text
  content           String   @db.Text
  videoUrl          String?
  audioUrl          String?
  imageUrl          String?
  order             Int      @default(0)
  duration          Int?     // Estimated duration in minutes
  isPublished       Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  course            Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  creator           User     @relation(fields: [creatorId], references: [id])
  progressReports   ProgressReport[]
  resources         Resource[]
  activities        Activity[]
}

model Resource {
  id                String   @id @default(cuid())
  lessonId          String
  title             String
  description       String?  @db.Text
  type              String   // pdf, video, audio, link, etc.
  url               String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  lesson            Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)
}

model Activity {
  id                String   @id @default(cuid())
  lessonId          String
  title             String
  description       String   @db.Text
  type              String   // quiz, assignment, discussion, etc.
  content           String   @db.Text
  duration          Int?     // Estimated duration in minutes
  points            Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  lesson            Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)
}

model Enrollment {
  id                String   @id @default(cuid())
  userId            String
  courseId          String
  status            String   @default("active") // active, completed, dropped
  progress          Int      @default(0) // 0-100 percentage
  startDate         DateTime @default(now())
  completionDate    DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  course            Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
}

// Assessment Models
model Assessment {
  id                String   @id @default(cuid())
  creatorId         String
  courseId          String?
  title             String
  description       String   @db.Text
  type              String   // quiz, test, assignment, project, etc.
  timeLimit         Int?     // Time limit in minutes
  passingScore      Int?     // Minimum score to pass
  isPublished       Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  creator           User     @relation(fields: [creatorId], references: [id])
  course            Course?  @relation(fields: [courseId], references: [id])
  questions         AssessmentQuestion[]
  responses         AssessmentResponse[]
}

model AssessmentQuestion {
  id                String   @id @default(cuid())
  assessmentId      String
  type              String   // multiple-choice, true-false, short-answer, essay, etc.
  question          String   @db.Text
  options           Json?    // For multiple choice questions
  correctAnswer     Json?    // Correct answer data for automatic grading
  expectedAnswer    String?  @db.Text  // Expected answer for open-ended questions
  points            Int      @default(1)
  order             Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  assessment        Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  answers           AssessmentAnswer[]
}

model AssessmentResponse {
  id           String   @id @default(cuid())
  assessmentId String
  userId       String
  status       String   @default("in_progress") // in_progress, completed
  score        Int?
  feedback     String?
  startedAt    DateTime @default(now())
  completedAt  DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  assessment   Assessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  answers      AssessmentAnswer[]
}

model AssessmentAnswer {
  id                 String   @id @default(cuid())
  assessmentResponseId String
  questionId         String
  answer             Json
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  response           AssessmentResponse @relation(fields: [assessmentResponseId], references: [id], onDelete: Cascade)
  question           AssessmentQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)
}

// Accessibility Models
model AccessibilitySettings {
  id                   String   @id @default(cuid())
  userId               String   @unique
  // High contrast settings
  highContrastMode     Boolean  @default(false)
  contrastMode         String   @default("high-contrast")
  textSize             Int      @default(100)
  contrastLevel        Int      @default(100)
  reduceAnimations     Boolean  @default(false)
  customTextColor      String?
  customBackgroundColor String?
  customLinkColor      String?
  // Screen reader settings
  screenReaderOptimized Boolean  @default(false)
  dyslexiaFriendly     Boolean  @default(false)
  dyslexiaFont         String   @default("opendyslexic")
  // Voice input settings
  voiceInputEnabled    Boolean  @default(false)
  voiceCommandsEnabled Boolean  @default(false)
  // Keyboard navigation
  keyboardNavigationOptimized Boolean @default(false)
  // Focus settings
  focusIndicators      Boolean  @default(true)
  // Motion sensitivity
  reduceMotion         Boolean  @default(false)
  // Color blindness settings
  colorBlindnessType   String?  // protanopia, deuteranopia, tritanopia, etc.
  // Speech settings
  speechRate           Float    @default(1.0)
  speechPitch          Float    @default(1.0)
  // Additional settings
  settings             Json?    // For future extensibility
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AccessibilityLog {
  id                   String   @id @default(cuid())
  userId               String
  action               String   // setting_changed, feature_used, etc.
  feature              String   // high-contrast-mode, screen-reader, voice-input, etc.
  details              Json
  createdAt            DateTime @default(now())
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Educational Psychologist Models
model EPProfile {
  id                String   @id @default(cuid())
  userId            String   @unique
  title             String   // Dr., Mr., Ms., etc.
  fullName          String
  qualifications    String[]
  specializations   String[]
  biography         String   @db.Text
  yearsOfExperience Int
  availability      Json     // Structure for availability calendar
  contactEmail      String?
  contactPhone      String?
  profileImageUrl   String?
  settings          Json?    // Preferences and settings
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  collaborations    EPCollaboration[] @relation("EPCollaborations")
  invitedCollaborations EPCollaboration[] @relation("InvitedCollaborations")
}

// EP Multi-Agency Collaboration Models
model EPCollaboration {
  id                String   @id @default(cuid())
  title             String
  description       String   @db.Text
  status            String   @default("active") // active, completed, archived
  initiatorId       String
  invitedEPIds      String[] // Array of invited EP user IDs
  studentId         String?  // Optional link to student
  caseDetails       String   @db.Text
  confidentialityLevel String @default("standard") // standard, high, restricted
  startDate         DateTime @default(now())
  endDate           DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  initiator         EPProfile @relation("EPCollaborations", fields: [initiatorId], references: [id])
  invitedEPs        EPProfile[] @relation("InvitedCollaborations")
  documents         EPDocument[]
  meetings          EPMeeting[]
  notes             EPNote[]
}

model EPDocument {
  id                String   @id @default(cuid())
  collaborationId   String
  title             String
  description       String?  @db.Text
  fileUrl           String
  fileType          String   // pdf, doc, image, etc.
  uploadedById      String
  accessLevel       String   @default("all") // all, initiator_only, specific_eps
  accessibleToIds   String[] // Array of EP IDs who can access
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  collaboration     EPCollaboration @relation(fields: [collaborationId], references: [id], onDelete: Cascade)
}

model EPMeeting {
  id                String   @id @default(cuid())
  collaborationId   String
  title             String
  description       String?  @db.Text
  meetingDate       DateTime
  duration          Int      // Duration in minutes
  location          String?  // Physical location or virtual meeting link
  attendeeIds       String[] // Array of EP IDs who should attend
  agenda            String?  @db.Text
  notes             String?  @db.Text
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  collaboration     EPCollaboration @relation(fields: [collaborationId], references: [id], onDelete: Cascade)
}

model EPNote {
  id                String   @id @default(cuid())
  collaborationId   String
  authorId          String
  content           String   @db.Text
  visibility        String   @default("all") // all, initiator_only, specific_eps
  visibleToIds      String[] // Array of EP IDs who can view
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  collaboration     EPCollaboration @relation(fields: [collaborationId], references: [id], onDelete: Cascade)
}

// IEP (Individual Education Plan) Models
model IEP {
  id                String   @id @default(cuid())
  studentId         String
  title             String
  status            String   @default("draft") // draft, active, archived, completed
  startDate         DateTime
  reviewDate        DateTime
  endDate           DateTime?
  createdById       String
  assignedEPId      String?
  schoolId          String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  goals             IEPGoal[]
  accommodations    IEPAccommodation[]
  assessments       IEPAssessment[]
  reviews           IEPReview[]
}

model IEPGoal {
  id                String   @id @default(cuid())
  iepId             String
  area              String   // academic, behavioral, social, etc.
  description       String   @db.Text
  baselineData      String   @db.Text
  targetDate        DateTime
  status            String   @default("in_progress") // not_started, in_progress, achieved, discontinued
  progress          Int      @default(0) // 0-100 percentage
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  iep               IEP      @relation(fields: [iepId], references: [id], onDelete: Cascade)
  objectives        IEPObjective[]
}

model IEPObjective {
  id                String   @id @default(cuid())
  goalId            String
  description       String   @db.Text
  successCriteria   String   @db.Text
  status            String   @default("in_progress") // not_started, in_progress, achieved, discontinued
  progress          Int      @default(0) // 0-100 percentage
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  goal              IEPGoal  @relation(fields: [goalId], references: [id], onDelete: Cascade)
}

model IEPAccommodation {
  id                String   @id @default(cuid())
  iepId             String
  category          String   // instructional, environmental, testing, etc.
  description       String   @db.Text
  frequency         String   // daily, as needed, during tests, etc.
  responsibility    String   // teacher, aide, student, etc.
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  iep               IEP      @relation(fields: [iepId], references: [id], onDelete: Cascade)
}

model IEPAssessment {
  id                String   @id @default(cuid())
  iepId             String
  name              String
  date              DateTime
  administrator     String
  results           String   @db.Text
  recommendations   String   @db.Text
  attachmentUrl     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  iep               IEP      @relation(fields: [iepId], references: [id], onDelete: Cascade)
}

model IEPReview {
  id                String   @id @default(cuid())
  iepId             String
  reviewDate        DateTime
  attendees         String[] // Array of attendee names or IDs
  progressSummary   String   @db.Text
  recommendations   String   @db.Text
  nextSteps         String   @db.Text
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  iep               IEP      @relation(fields: [iepId], references: [id], onDelete: Cascade)
}

// Communication Models
model Notification {
  id                String   @id @default(cuid())
  userId            String
  title             String
  content           String   @db.Text
  type              String   // info, warning, alert, success
  isRead            Boolean  @default(false)
  link              String?  // Optional link to related content
  createdAt         DateTime @default(now())
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Message {
  id                String   @id @default(cuid())
  senderId          String
  recipientId       String
  subject           String
  content           String   @db.Text
  isRead            Boolean  @default(false)
  createdAt         DateTime @default(now())
  sender            User     @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  recipient         User     @relation(fields: [recipientId], references: [id], onDelete: Cascade)
}

// Pupil Voice Survey Models
model PupilVoiceSurvey {
  id                String   @id @default(cuid())
  title             String
  description       String   @db.Text
  status            String   @default("draft") // draft, active, closed
  createdById       String
  targetAudience    String   // all, specific_grades, specific_students
  targetIds         String[] // Array of grade levels or student IDs
  startDate         DateTime @default(now())
  endDate           DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  questions         PupilVoiceQuestion[]
  responses         PupilVoiceResponse[]
}

model PupilVoiceQuestion {
  id                String   @id @default(cuid())
  surveyId          String
  type              String   // multiple-choice, rating, open-ended, etc.
  question          String   @db.Text
  options           Json?    // For multiple choice or rating questions
  required          Boolean  @default(true)
  order             Int      @default(0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  survey            PupilVoiceSurvey @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  answers           PupilVoiceAnswer[]
}

model PupilVoiceResponse {
  id                String   @id @default(cuid())
  surveyId          String
  userId            String
  status            String   @default("in_progress") // in_progress, completed
  startedAt         DateTime @default(now())
  completedAt       DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  survey            PupilVoiceSurvey @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  answers           PupilVoiceAnswer[]
}

model PupilVoiceAnswer {
  id                String   @id @default(cuid())
  responseId        String
  questionId        String
  answer            Json
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  response          PupilVoiceResponse @relation(fields: [responseId], references: [id], onDelete: Cascade)
  question          PupilVoiceQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)
}
